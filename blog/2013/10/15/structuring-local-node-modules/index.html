
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>Structuring Library Functionality in Node.js Projects - The Attic</title>
  <meta name="author" content="Andrew Winder">

  
  <meta name="description" content="Structuring Library Functionality in Node.js Projects October 15, 2013 @ 10:05 PM EDT express.js, modules, node.js, npm Recently I needed to start &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://awinder.github.io/blog/2013/10/15/structuring-local-node-modules">
  <link href="/favicon.png" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <link href="/stylesheets/bootstrap.min.css" media="screen, projection" rel="stylesheet" type="text/css">
  <link href="/stylesheets/bootstrap-responsive.min.css" media="screen, projection" rel="stylesheet" type="text/css">
  <link href="/stylesheets/font-awesome.min.css" media="screen, projection" rel="stylesheet" type="text/css">
  <link href="/stylesheets/attic.css" media="screen, projection" rel="stylesheet" type="text/css">
  <link href="/atom.xml" rel="alternate" title="The Attic" type="application/atom+xml">
  <script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
  <script>!window.jQuery && document.write(unescape('%3Cscript src="./javascripts/lib/jquery.min.js"%3E%3C/script%3E'))</script>
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="http://fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="http://fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">

  
  <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-44769789-1']);
    _gaq.push(['_trackPageview']);

    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
  </script>


</head>

<body   >
  <div class="container-fluid">
    <div class="row header">
      <nav>
  <a href="/"><h2 class="lede span4">The Attic</h2></a>
  <ul class="span4 visible-phone social">
    <li class="photo"></li>
  </ul>
  <ul class="span4 visible-tablet social">
    <li class="twitter"><a href="http://www.twitter.com/awinder"><i class="icon-4x icon-twitter"></i></a></li>
    <li class="rss"><a href="/atom.xml"><i class="icon-4x icon-rss"></i></a></li>
    <li class="linkedin"><a href="http://www.linkedin.com/in/ajwinder"><i class="icon-4x icon-linkedin"></i></a></li>
  </ul>
  <ul class="pull-right visible-desktop social">
    <li class="twitter"><a href="http://www.twitter.com/awinder"><i class="icon-2x icon-twitter"></i>@awinder</a></li>
    <li class="rss"><a href="/atom.xml"><i class="icon-2x icon-rss"></i> rss</a></li>
    <li class="linkedin"><a href="http://www.linkedin.com/in/ajwinder"><i class="icon-2x icon-linkedin"></i> linkedin</a></li>
  </ul>
</nav>


    </div>
    <div class="row-fluid mainbody">
      <div class="sidebar">
        <span class="face"></span>
<span class="byline">Hi, I'm Andrew Winder, and I'm a Web Application developer at <a href="http://www.messagesystems.com">Message Systems</a>.</span>

<ul id="drawer">
  <li><a href="/blog/archives">Archive</a></li>
</ul>
<ul id="social-links">
  <li><a href="http://www.github.com/awinder" class="icon-github">&nbsp;+github</a></li>
  <li class="linkedin visible-phone"><a href="http://www.linkedin.com/in/ajwinder"><i class="icon icon-linkedin"></i> +linkedin</a></li>
  <li class="twitter visible-phone"><a href="http://www.twitter.com/awinder"><i class="icon icon-twitter"></i> @awinder</a></li>
</ul>

      </div>
      <div class="span9">
        <article role="article">
  <h3>Structuring Library Functionality in Node.js Projects</h3>
  <div class="info">
    <time class="date">October 15, 2013</time>
    <time class="hidden-phone"> @ 10:05 PM EDT</time>
    <span class="tags">
      
        <a class='category' href='/blog/categories/express-dot-js/'>express.js</a>, <a class='category' href='/blog/categories/modules/'>modules</a>, <a class='category' href='/blog/categories/node-dot-js/'>node.js</a>, <a class='category' href='/blog/categories/npm/'>npm</a>
      
    </span>
  </div>
  <p>Recently I needed to start thinking about adding reusable &ldquo;library&rdquo; components to an <a href="http://www.expressjs.com">Express.js</a> node.js project, and I hit a bit of a brick wall.  The library functionality was fairly specific to the application, and it just doesn&rsquo;t make that much sense to break it out as seperately-packaged module right now.  Seems like a fairly common use-case, right?  Well, apparently not.  You can load any filepath through the <code>require()</code> system, like so:</p>

<div><script src='https://gist.github.com/8552134.js?file=app.js'></script>
<noscript><pre><code>var module = require('./lib/myModule');
...</code></pre></noscript></div>


<p>But where this can quickly become a nuisance is when you are nested down a deep folder hierarchy:</p>

<div><script src='https://gist.github.com/8552134.js?file=itemModel.js'></script>
<noscript><pre><code>var module = require('../../../lib/myModule');
...
</code></pre></noscript></div>


<p>Having to track the folder hierarchy is a little bit of an inconvience, especially when compared to the convience of the <a href="https://npmjs.org">NPM</a> module system.  Searching around for some solutions, I found issues with the approaches commonly suggested:</p>

<ul>
<li><strong>Modify the paths where require.js scans for modules</strong> &ndash; In <a href="http://nodejs.org/docs/v0.4.1/api/all.html#loading_from_the_require.paths_Folders">previous versions</a> of node, it looks like you could modify the paths require.js searched through, but this method has been deprecated and was not a &ldquo;best practice&rdquo; while available.</li>
<li><strong>Load the path to your library directory into a global</strong> &ndash; I wanted to figure out a way around needing to declare some application-wide globals.  doing something like this might also create some unit testing concerns.</li>
<li><strong>Utilize <a href="https://npmjs.org/doc/link.html">npm-link</a></strong> &ndash; This seemed great at first blush, but the actual mechanics of how npm-link works are a little perculiar.  Npm-link first symlinks a specified module in your project directory to the global npm module location.  Then, it&rsquo;s symlinks that global location to a module in your local project&rsquo;s node_modules directory.  This means naming collisions could occur if you tried to use this method with two projects on the same machine.</li>
<li><strong>Just put your library modules in the node_modules directory!</strong> &ndash; Right now, this project&rsquo;s node_modules directory only includes community packages, and they&rsquo;re all installed through <code>package.json</code>.  This provides nice separation in the code &mdash; <code>node_modules</code> is not our code, everything else is.  The node_modules directory is actually ignored in source control to disuade developers from mucking around with our open-source libraries.</li>
</ul>


<p>Npm-link got me thinking though, and a <a href="http://mathematism.com">co-worker</a> clued in on that too.  We could create a &ldquo;library&rdquo; module, which acted mostly as a namespace for our project&rsquo;s unique library-type functionality.  Each of those unique pieces would be submodules of the &ldquo;library&rdquo; module.  Then, we can create a symlink from the node_modules directory to the library directory, and commit that symlink into our source control.  Now our code can look like this:</p>

<div><script src='https://gist.github.com/8552134.js?file=newItemModel.js'></script>
<noscript><pre><code>var module = require('lib/myModule');
...
</code></pre></noscript></div>


<p>We get the benefits of keeping our code outside of the node_modules directory, but with the benefits of it living within the <code>require()</code> lookup path.  It&rsquo;s working out great so far, and I&rsquo;m happy we ended up finding a very straightforward solution to our problem.</p>

<p><img src="/images/posts/2013-10-15-structuring-local-node-modules/folder-structure.png" alt="Example folder structure" /></p>

</article>        
      </div>
    </div>
    <footer>
      <p>&copy;&nbsp;Andrew Winder, 2013.  All rights reserved.
    </footer>
  </div>  
</body>
</html>
